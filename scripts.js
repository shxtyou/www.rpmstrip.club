[ПОЛНЫЙ JS ИЗ ПРЕДЫДУЩЕГО ОТВЕТА, сокращён здесь ради примера]